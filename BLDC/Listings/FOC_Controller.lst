C251 COMPILER V5.60.0,  FOC_Controller                                                     27/02/25  18:35:06  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE FOC_Controller
OBJECT MODULE PLACED IN .\Objects\FOC_Controller.obj
COMPILER INVOKED BY: D:\mcu\Keil5\C251\BIN\C251.EXE FOC_Controller.c INTR2 BROWSE DEBUG PRINT(.\Listings\FOC_Controller.
                    -lst) OBJECT(.\Objects\FOC_Controller.obj) 

stmt  level    source

    1          #include <AI8051U.H>
    2          #include <intrins.h>
    3          #include <math.h>
    4          #include "PWM_Controller.h"
    5          
    6          #define PI 3.14159265358979323846
    7          
    8          #define _constrain(amt,low,high) ((amt)<(low)?(low):((amt)>(high)?(high):(amt)))
    9          
   10          double Electric_Angle;
   11          double Shaft_Angle;
   12          double Ualpha;
   13          double Ubeta;
   14          double Ua;
   15          double Ub;
   16          double Uc;
   17          double DC_a;
   18          double DC_b;
   19          double DC_c;
   20          double Uq;
   21          
   22          float voltage_power_supply = 12;//12v??
   23          float Ts = 0.001; //1ms ç³»ç»Ÿæ—¶é—´é—´éš”
   24          
   25          double _electric_Angle(double shaft_angle, int pole_pairs) //ç”µæœºçš„ç”µè§’åº¦ = æœºæ¢°è§’åº¦ * æžå¯¹æ•
             -°
   26          {
   27   1          return shaft_angle * pole_pairs;
   28   1      }
   29          
   30          double _normalizeAngle(double angle) //æŽ§åˆ¶åœ¨0~2Ï€ä¹‹é—´ LOL
   31          {
   32   1          while(angle > 2*PI)
   33   1          {
   34   2              angle -= 2*PI;
   35   2          }
   36   1          while(angle < 0)
   37   1          {
   38   2              angle += 2*PI;
   39   2          }
   40   1          return angle;
   41   1      }
   42          
   43          void Set_PWM(double Ua, double Ub, double Uc)
   44          {
   45   1          DC_a = _constrain(Ua/voltage_power_supply, 0.0f, 1.0f);
   46   1          DC_b = _constrain(Ub/voltage_power_supply, 0.0f, 1.0f);
   47   1          DC_c = _constrain(Uc/voltage_power_supply, 0.0f, 1.0f);
   48   1      
   49   1          PWM_DUTY0 = (unsigned char)(DC_a * 100);
   50   1          PWM_DUTY1 = (unsigned char)(DC_b * 100);
   51   1          PWM_DUTY2 = (unsigned char)(DC_c * 100);
   52   1      }
   53          
   54          void OutPutter(double Uq, double Ud, double angle_elsped) //Udæš‚æ—¶ä¸çŸ¥é“2333ï¼Œè²Œä¼¼å½±å“ä¸å¤§ï¼Œ
             -ä½†æ˜¯ç•™ç€.Uqæ˜¯ä¸»è¦çš„ï¼ŒUdç›´è½´ç”µåŽ‹ï¼Œä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆå«_elsped?LOL LUA
   55          {
   56   1          angle_elsped = _normalizeAngle(angle_elsped);
C251 COMPILER V5.60.0,  FOC_Controller                                                     27/02/25  18:35:06  PAGE 2   

   57   1      
   58   1          /* å¸•å…‹å˜æ¢ */
   59   1          Ualpha = -Uq * sin(angle_elsped) + Ud * cos(angle_elsped); 
   60   1          Ubeta = Uq * cos(angle_elsped) + Ud * sin(angle_elsped); 
   61   1      
   62   1          /* é€†å…‹æ‹‰å…‹å˜æ¢ */
   63   1          Ua = Ualpha + voltage_power_supply/2; //ç”µåŽ‹è¢«å¹³ç§»åˆ°ä¸­é—´åŽ»çŽ©
   64   1          Ub = (sqrt(3)*Ubeta-Ualpha)/2 + voltage_power_supply/2;
   65   1          Uc = (-Ualpha-sqrt(3)*Ubeta)/2 + voltage_power_supply/2;
   66   1          
   67   1          Set_PWM(Ua,Ub,Uc); //è¿˜æ˜¯åœ¨è¿™é‡Œåšè½¬åŒ–å§
   68   1      }
   69          
   70          double velocityOpenloop(double target_velocity) //finally...
   71          {
   72   1          /* ä½¿ç”¨æ—©å‰è®¾ç½®çš„voltage_power_supplyçš„1/3ä½œä¸ºUqå€¼ï¼Œè¿™ä¸ªå€¼ä¼šç›´æŽ¥å½±å“è¾“å‡ºåŠ›çŸ©
   73   1          æœ€å¤§åªèƒ½è®¾ç½®ä¸ºUq = voltage_power_supply/2ï¼Œå¦åˆ™ua,ub,ucä¼šè¶…å‡ºä¾›ç”µç”µåŽ‹é™å¹… */
   74   1          Uq = voltage_power_supply/3;
   75   1      
   76   1      //
   77   1          Shaft_Angle = _normalizeAngle(Shaft_Angle + target_velocity*Ts); //emmç„¶åŽå°±æ˜¯æœºæ¢°è§’åº¦çš„å½’ä
             -¸€åŒ–damn
   78   1      //
   79   1      
   80   1          OutPutter(Uq, 0.0, _electric_Angle(Shaft_Angle, 1.0));
   81   1          return Uq;
   82   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       579     ------
  ecode size           =    ------     ------
  data size            =        52         16
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        16     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
